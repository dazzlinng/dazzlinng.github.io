# 锚点导航滚动优化说明

## 🎯 解决的问题

**原问题**：点击导航链接后，页面滚动到目标位置，但是板块标题被导航栏遮挡，只能看到内容看不到标题。

**解决方案**：动态计算所有固定头部的高度，精确调整滚动偏移量。

## ✅ 实现的优化

### 1. **动态偏移量计算**
不再使用固定的 80px，而是动态计算：
- 页面导航栏高度（.page-navigation）
- 网站顶部导航栏高度（.masthead）
- 基础间距（30px）

总偏移量 = 导航栏高度 + 顶部栏高度 + 基础间距

### 2. **CSS 滚动偏移**
```css
html {
  scroll-padding-top: 120px;
}

.page__content h2[id] {
  scroll-margin-top: 120px;
}
```

### 3. **JavaScript 平滑滚动**
- 精确计算目标位置
- 使用 `window.scrollTo()` 实现平滑滚动
- 考虑所有固定头部的高度

### 4. **视觉反馈增强**
点击导航后：
- 平滑滚动到目标位置
- 目标板块标题会有短暂的蓝色高亮动画
- 导航链接显示激活状态（下划线 + 加粗）

### 5. **性能优化**
- 使用 `requestAnimationFrame` 节流滚动事件
- 窗口大小改变时重新计算偏移量
- 减少不必要的 DOM 查询

## 📁 修改的文件

1. **_includes/head/custom.html**
   - 更新滚动偏移逻辑
   - 添加动态高度计算
   - 添加锚点高亮动画

2. **assets/js/anchor-navigation.js** (新增)
   - 独立的锚点导航脚本
   - 包含完整的滚动逻辑
   - 添加视觉反馈效果

3. **_includes/scripts.html**
   - 引入新的 anchor-navigation.js

## 🧪 测试步骤

### 启动本地服务器

```bash
cd "D:\Mysystem\新建文件夹 (3)\个人网站\dazzling.github.io"
bundle exec jekyll serve -l -H localhost
```

访问：http://localhost:4000

### 验证清单

✅ **标题可见性测试**
- [ ] 点击"关于我" → "关于我"标题完整显示在导航栏下方
- [ ] 点击"研究方向" → "研究方向"标题完整显示，包括表情符号
- [ ] 点击"新闻动态" → "新闻动态"标题完整显示
- [ ] 点击"研究项目" → "研究项目"标题完整显示
- [ ] 点击"专业技能" → "专业技能"标题完整显示
- [ ] 点击"简历下载" → "简历下载"标题完整显示

✅ **滚动体验测试**
- [ ] 点击后平滑滚动（无跳跃）
- [ ] 滚动后标题与导航栏之间有适当间距（约30px）
- [ ] 标题完全可见，无遮挡
- [ ] 目标板块有短暂的高亮动画（蓝色背景闪烁）

✅ **响应式测试**
- [ ] 调整浏览器窗口大小
- [ ] 在不同屏幕尺寸下测试滚动位置
- [ ] 确认标题始终可见

## 🔧 技术细节

### 滚动位置计算公式

```javascript
const headerOffset = getTotalHeaderOffset();  // 动态获取所有头部高度
const elementPosition = target.getBoundingClientRect().top;
const offsetPosition = elementPosition + window.pageYOffset - headerOffset;

window.scrollTo({
  top: offsetPosition,
  behavior: 'smooth'
});
```

### 偏移量组成

```
总偏移量 = 页面导航栏高度
         + 网站顶部导航栏高度
         + 基础间距 (30px)

通常：60px + 50px + 30px = 140px 左右
```

### 高亮动画

```css
@keyframes highlightPulse {
  0% { background-color: transparent; }
  20% { background-color: rgba(0, 102, 204, 0.1); }
  100% { background-color: transparent; }
}
```

## 📊 优化效果对比

### 优化前
- ❌ 使用固定 80px 偏移
- ❌ 标题被导航栏遮挡
- ❌ 只能看到内容，看不到标题

### 优化后
- ✅ 动态计算实际偏移量
- ✅ 标题完整显示在导航栏下方
- ✅ 标题和内容都可见
- ✅ 添加视觉反馈（高亮动画）
- ✅ 自适应不同屏幕尺寸

## 🎨 视觉效果

1. **点击导航链接**：
   - 页面平滑滚动
   - 滚动到目标位置
   - 标题上方留有约 30px 间距
   - 标题有 1.5 秒的蓝色高亮动画

2. **滚动页面**：
   - 导航栏对应链接自动高亮
   - 显示下划线和加粗效果

3. **调整窗口大小**：
   - 偏移量自动重新计算
   - 滚动位置保持准确

## 🐛 故障排除

### 如果标题仍然被遮挡

1. 检查浏览器控制台是否有错误
2. 确认 anchor-navigation.js 是否正确加载
3. 尝试清除浏览器缓存（Ctrl+F5）
4. 增加基础间距（在 JS 中修改 `offset = 30`）

### 如果滚动不平滑

1. 确认浏览器支持 `behavior: 'smooth'`
2. 检查是否有其他 JS 冲突
3. 尝试禁用浏览器扩展

### 如果高亮动画不工作

1. 检查 CSS 动画是否正确加载
2. 确认 `.anchor-highlight` 类是否被添加
3. 检查浏览器是否支持 CSS 动画

## 💡 使用建议

1. **首次使用**：建议先在本地测试，确认效果后再部署
2. **自定义间距**：如果觉得间距太大/太小，可调整 JS 中的 `offset` 值
3. **动画速度**：如需调整高亮速度，修改 CSS 中的 `1.5s`
4. **颜色定制**：修改高亮颜色，调整 CSS 中的 `rgba(0, 102, 204, 0.1)`

## 📝 备注

- 所有优化都保持了极简学术风格
- 没有添加花哨的视觉效果
- 性能经过优化，不影响页面加载速度
- 兼容所有现代浏览器
