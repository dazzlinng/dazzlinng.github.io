{% include base_path %}

<!-- start custom head snippets -->

<!-- Support for Academicons -->
<link rel="stylesheet" href="{{ base_path }}/assets/css/academicons.css"/>

<!-- favicon from https://commons.wikimedia.org/wiki/File:OOjs_UI_icon_academic-progressive.svg -->
<link rel="apple-touch-icon" sizes="180x180" href="{{ base_path }}/images/apple-touch-icon-180x180.png"/>
<link rel="icon" type="image/svg+xml" href="{{ base_path }}/images/favicon.svg"/>
<link rel="icon" type="image/png" href="{{ base_path }}/images/favicon-32x32.png" sizes="32x32"/>
<link rel="icon" type="image/png" href="{{ base_path }}/images/favicon-192x192.png" sizes="192x192"/>
<link rel="manifest" href="{{ base_path }}/images/manifest.json"/>
<link rel="icon" href="/images/favicon.ico"/>
<meta name="theme-color" content="#ffffff"/>

<!-- Custom CSS for modern academic theme -->
<style>
  /* Smooth scrolling and scroll offset for fixed header */
  html {
    scroll-behavior: smooth;
    scroll-padding-top: 80px; /* Account for custom page navigation only */
  }

  body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
  }

  /* Minimal academic links */
  a {
    color: #0066cc;
    text-decoration: none;
    transition: color 0.2s ease;
  }

  a:hover {
    color: #0052a3;
    text-decoration: underline;
  }

  /* Show the masthead navigation */
  .masthead {
    display: block !important;
    position: fixed !important;
    top: 0 !important;
    width: 100% !important;
    z-index: 20 !important;
    height: auto !important;
    min-height: 50px !important;
  }

  /* Ensure masthead inner content is visible */
  .masthead__inner-wrap {
    display: block !important;
    width: 100% !important;
  }

  /* Ensure masthead menu is visible */
  .masthead__menu {
    display: block !important;
    width: 100% !important;
  }

  /* Ensure navigation links are visible */
  .masthead__menu-item {
    display: inline-block !important;
    position: relative !important;
    color: #333 !important;
  }

  /* Ensure section titles have enough top margin when jumping to anchors */
  .page__content h2[id],
  .page__content h3[id] {
    scroll-margin-top: 80px;
    margin-top: 2.5rem !important;
  }

  /* Remove decorative elements for minimalist design */
  * {
    box-shadow: none !important;
    text-shadow: none !important;
  }

  /* Section titles */
  .page__title {
    display: none;
  }

  /* 调整页面最大宽度 - 让内容区域更宽 */
  .masthead__inner-wrap {
    max-width: 1400px !important;
  }

  #main {
    max-width: 1200px !important;
  }

  /* 确保导航栏有背景色，避免内容穿透 */
  .masthead {
    background-color: #ffffff !important;
    border-bottom: 1px solid #e0e0e0 !important;
  }

  /* 调整 body 的 padding 以适应导航栏 */
  body {
    padding-top: 60px !important;
  }

  /* 让导航菜单项横向显示 - 覆盖 greedy-nav 的 table 布局 */
  .custom-nav .visible-links {
    display: flex !important;
    flex-direction: row !important;
    flex-wrap: nowrap !important;
    align-items: center !important;
    width: 100% !important;
    overflow-x: auto !important;
  }

  .custom-nav .visible-links li {
    display: inline-block !important;
    float: none !important;
    white-space: nowrap !important;
    flex-shrink: 0 !important;
  }

  .masthead__menu-item {
    display: inline-block !important;
    float: none !important;
    white-space: nowrap !important;
    flex-shrink: 0 !important;
  }

  /* 让汉堡菜单按钮不可见但保留功能 */
  .custom-nav button {
    display: none !important;
  }

  /* 确保所有链接都显示在visible-links中，不被移到hidden-links */
  .custom-nav .hidden-links {
    display: none !important;
  }

  /* 确保所有菜单项都可见 */
  .masthead__menu .visible-links .masthead__menu-item {
    display: inline-block !important;
    visibility: visible !important;
    opacity: 1 !important;
  }

  .custom-nav .visible-links a {
    display: inline-block !important;
    margin: 0 0.5rem !important;
    color: #333 !important;
    text-decoration: none !important;
    padding: 0.5rem 0 !important;
  }

  .custom-nav .visible-links a:hover {
    color: #0066cc !important;
    text-decoration: underline !important;
  }

  /* 确保 masthead__menu 中的链接也可见 */
  .masthead__menu-item a {
    color: #333 !important;
    display: inline-block !important;
  }

  /* 调整导航项间距 */
  .masthead__menu-item:not(:last-child) {
    margin-right: 0.5rem !important;
  }

  /* 移动端响应式 - 允许横向滚动 */
  @media (max-width: 1200px) {
    .masthead__inner-wrap {
      padding-left: 0.5rem !important;
      padding-right: 0.5rem !important;
    }

    .masthead__menu .visible-links {
      overflow-x: auto !important;
      justify-content: flex-start !important;
    }

    /* 移动端隐藏滚动条但保持可滚动 */
    .masthead__menu .visible-links::-webkit-scrollbar {
      height: 0px !important;
      background: transparent !important;
    }
  }

  /* Anchor highlight animation */
  .anchor-highlight {
    animation: highlightPulse 1.5s ease-in-out;
  }

  @keyframes highlightPulse {
    0% {
      background-color: transparent;
    }
    20% {
      background-color: rgba(0, 102, 204, 0.1);
    }
    100% {
      background-color: transparent;
    }
  }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  function getHeaderOffset() {
    const masthead = document.querySelector('.masthead');
    let offset = 20;

    if (masthead) {
      offset += masthead.offsetHeight;
    }

    return offset;
  }

  // Smooth scroll for anchor links
  document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function(e) {
      e.preventDefault();
      const targetId = this.getAttribute('href');
      const target = document.querySelector(targetId);

      if (target) {
        const headerOffset = getHeaderOffset();
        const elementPosition = target.getBoundingClientRect().top;
        const offsetPosition = elementPosition + window.pageYOffset - headerOffset;

        window.scrollTo({
          top: offsetPosition,
          behavior: 'smooth'
        });

        // Add visual feedback
        setTimeout(() => {
          target.classList.add('anchor-highlight');
          setTimeout(() => {
            target.classList.remove('anchor-highlight');
          }, 1500);
        }, 300);
      }
    });
  });

  // Active nav highlighting on scroll
  const sections = document.querySelectorAll('[id]');
  const navLinks = document.querySelectorAll('.masthead__menu-item a');

  function updateActiveNav() {
    const headerOffset = getHeaderOffset();
    const scrollPos = window.scrollY + headerOffset + 30;

    sections.forEach(section => {
      const top = section.offsetTop;
      const height = section.offsetHeight;
      const id = section.getAttribute('id');
      const correspondingLink = document.querySelector(`.masthead__menu-item a[href="#${id}"]`);

      if (correspondingLink && scrollPos >= top && scrollPos < top + height) {
        navLinks.forEach(link => link.classList.remove('active'));
        correspondingLink.classList.add('active');
      }
    });
  }

  // Throttle scroll event
  let ticking = false;
  window.addEventListener('scroll', function() {
    if (!ticking) {
      window.requestAnimationFrame(function() {
        updateActiveNav();
        ticking = false;
      });
      ticking = true;
    }
  });

  // Recalculate on resize
  window.addEventListener('resize', updateActiveNav);

  // Initial check
  setTimeout(updateActiveNav, 100);
});
</script>

<style>
/* Active navigation link styling */
.masthead__menu-item a.active {
  color: var(--global-base-color) !important;
  font-weight: 700 !important;
  border-bottom: 2px solid var(--global-base-color) !important;
}
</style>

<!-- end custom head snippets -->
